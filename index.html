<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;padding:20px;background:#eef2ff}
h1{color:#1e40af}
select,input,button{padding:6px}
table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff}
th,td{border:1px solid #ccc;padding:6px}
th{background:#e0ecff}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
.btn{background:#2563eb;color:#fff;border:none;border-radius:6px;cursor:pointer}
.btn.red{background:#dc2626}
</style>
</head>

<body>

<h1>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–æ–∑–∫–∏ (Firebase)</h1>

<div class="controls">
  <select id="deptFilter">
    <option value="">–í—Å–µ —É—á–∞—Å—Ç–∫–∏</option>
  </select>

  <input id="search" placeholder="–ü–æ–∏—Å–∫ –§–ò–û">

  <button id="addBtn" class="btn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<table>
<thead>
<tr>
<th>–§–ò–û</th>
<th>–£—á–∞—Å—Ç–æ–∫</th>
<th>–û–±—â–µ–∂–∏—Ç–∏–µ</th>
<th>–û—Ç–∫—É–¥–∞</th>
<th>–ö—É–¥–∞</th>
<th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<!-- üî• FIREBASE -->
<script type="module">
/* ---------- Firebase CDN imports ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  doc,
  updateDoc,
  deleteDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

/* ---------- –¢–í–û–ô CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyB8vMgNgtbrGPf21SeGsxhCaeeS3DLuzEc",
  authDomain: "transpotkit.firebaseapp.com",
  projectId: "transpotkit",
  storageBucket: "transpotkit.firebasestorage.app",
  messagingSenderId: "276561044748",
  appId: "1:276561044748:web:8de739a57f964944559529",
  measurementId: "G-5BDNMYC33X"
};

/* ---------- Init ---------- */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const employeesCol = collection(db, "employees");

/* ---------- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ---------- */
const departments = [
  "–õ–¶–ü ‚Ññ1","–õ–¶–ü ‚Ññ2","–õ–¶–ü‚Ññ3","–ü–æ—Ç–æ–ª–∫–∏","–ê—Ä–º.–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
  "–¶–µ—Ö –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏","–°–¢–ö","–í–ò–°","–≠–û–ú","–ë–°–¶","–ö—Ä–æ–≤–ª—è","–§–∞—Å–∞–¥"
];

const dorms = [
  "–û–±—â–µ–∂–∏—Ç–∏–µ –õ–µ—Ç–æ–≤–æ","–û–±—â–µ–∂–∏—Ç–∏–µ –ú—ã—Ç–∏—â–∏","–û–±—â–µ–∂–∏—Ç–∏–µ –ü–ª–µ—â–µ–µ–≤–∞",
  "–û–±—â–µ–∂–∏—Ç–∏–µ –ë–µ–∫–∞—Å–æ–≤–æ","–û–±—â–µ–∂–∏—Ç–∏–µ –ú–∞—Ä—É—à–∫–∏–Ω–æ","–û–±—â–µ–∂–∏—Ç–∏–µ –°–æ–≤–µ—Ç—Å–∫–∞—è 4"
];

const places = [
  "–ó–∞–≤–æ–¥ –ú–∞—Ä—É—à–∫–∏–Ω–æ","–Ø–∫–æ–≤–ª–µ–≤–æ","9—è –°–µ–≤–µ—Ä–Ω–∞—è","–ù–æ–≤–æ—Ö–æ—Ö–ª–æ–≤—Å–∫–∞—è",
  "–¢–∞—Ä—É—Å–∞","–ß–µ—Ä–µ–º—É—à–∫–∏","–ö–æ—Ä–æ–ª–µ–≤/–ö–æ–º–º—É–Ω–∞—Ä–∫–∞","–î–æ–º"
];

/* ---------- State ---------- */
let employees = [];

/* ---------- UI ---------- */
const tbody = document.getElementById("tbody");
const deptFilter = document.getElementById("deptFilter");
const search = document.getElementById("search");

/* —Ñ–∏–ª—å—Ç—Ä –ø–æ —É—á–∞—Å—Ç–∫—É */
departments.forEach(d=>{
  const o=document.createElement("option");
  o.value=o.textContent=d;
  deptFilter.appendChild(o);
});

/* ---------- Realtime –∑–∞–≥—Ä—É–∑–∫–∞ ---------- */
onSnapshot(employeesCol, snapshot=>{
  employees = snapshot.docs.map(d=>({ id:d.id, ...d.data() }));
  render();
});

/* ---------- Render ---------- */
function render(){
  let list=[...employees];

  if(deptFilter.value)
    list=list.filter(e=>e.department===deptFilter.value);

  if(search.value)
    list=list.filter(e=>(e.fullName||"").toLowerCase().includes(search.value.toLowerCase()));

  tbody.innerHTML=list.map(e=>`
    <tr>
      <td><input value="${e.fullName||""}" data-id="${e.id}" data-f="fullName"></td>
      <td>${select(departments,e.department,e.id,"department")}</td>
      <td>${select(dorms,e.dorm,e.id,"dorm")}</td>
      <td>${select(places,e.from,e.id,"from")}</td>
      <td>${select(places,e.to,e.id,"to")}</td>
      <td><button class="btn red" data-del="${e.id}">√ó</button></td>
    </tr>
  `).join("");
}

function select(arr,val,id,f){
  return `<select data-id="${id}" data-f="${f}">
    <option value=""></option>
    ${arr.map(x=>`<option ${x===val?"selected":""}>${x}</option>`).join("")}
  </select>`;
}

/* ---------- Events ---------- */
tbody.addEventListener("change", async e=>{
  const id=e.target.dataset.id;
  const f=e.target.dataset.f;
  if(!id||!f)return;
  await updateDoc(doc(db,"employees",id),{[f]:e.target.value});
});

tbody.addEventListener("input", async e=>{
  const id=e.target.dataset.id;
  const f=e.target.dataset.f;
  if(f!=="fullName")return;
  await updateDoc(doc(db,"employees",id),{fullName:e.target.value});
});

tbody.addEventListener("click", async e=>{
  if(!e.target.dataset.del)return;
  await deleteDoc(doc(db,"employees",e.target.dataset.del));
});

document.getElementById("addBtn").onclick=async()=>{
  await addDoc(employeesCol,{
    fullName:"",
    department:deptFilter.value||"",
    dorm:"",
    from:"",
    to:""
  });
};

deptFilter.onchange=render;
search.oninput=render;
</script>

</body>
</html>
